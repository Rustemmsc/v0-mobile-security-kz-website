# Инструкция по настройке админ-панели MobileSecurity.kz

## Шаг 1: Создание структуры базы данных

1. Запустите SQL скрипт для создания таблиц:
   - Откройте v0 интерфейс
   - Найдите файл `scripts/001_create_admin_tables.sql`
   - Запустите скрипт (кнопка "Run" рядом с файлом)
   - Дождитесь сообщения об успешном выполнении

2. Опционально: Загрузите начальные данные:
   - Запустите скрипт `scripts/002_seed_initial_data.sql`
   - Это добавит примеры категорий товаров

## Шаг 2: Создание первого администратора

### Вариант А: Через страницу Setup (рекомендуется)

1. Откройте в браузере: `/admin/setup`
2. Введите данные первого администратора:
   - **Email**: например, `admin@mobilesecurity.kz`
   - **Пароль**: минимум 6 символов (рекомендуется сложный пароль)
3. Нажмите кнопку **"Создать администратора"**
4. Дождитесь подтверждения создания
5. Нажмите **"Перейти к входу"**

**Примечание**: Supabase может отправить письмо с подтверждением на указанный email. Проверьте почту (включая папку "Спам").

### Вариант Б: Через SQL (если Setup не работает)

1. Запустите скрипт `scripts/003_create_first_admin.sql`:
   - Измените в скрипте `'admin@mobilesecurity.kz'` на ваш email
   - Запустите скрипт
2. В Supabase Dashboard:
   - Перейдите в Authentication → Users
   - Создайте нового пользователя с тем же email
   - Скопируйте его User ID
3. Обновите запись в таблице `admins`:
   \`\`\`sql
   UPDATE admins 
   SET user_id = 'ВСТАВЬТЕ_USER_ID_СЮДА' 
   WHERE email = 'admin@mobilesecurity.kz';
   \`\`\`

## Шаг 3: Вход в админ-панель

1. Откройте: `/admin/auth/login`
2. Введите созданные данные:
   - Email администратора
   - Пароль
3. Нажмите **"Войти"**
4. Вы попадете в админ-панель на `/admin`

## Шаг 4: Управление администраторами

После входа как Super Admin вы можете:

1. Перейдите в раздел **"Администраторы"** (Users) в боковом меню
2. Нажмите **"Добавить администратора"**
3. Заполните форму:
   - Email нового администратора
   - Пароль (минимум 6 символов)
   - Роль:
     - **Super Admin** - полный доступ + управление администраторами
     - **Admin** - базовый доступ (товары, контент, заказы)
4. Нажмите **"Создать"**

### Управление существующими администраторами:

- **Деактивация**: нажмите переключатель в колонке "Активен"
- **Изменение роли**: нажмите кнопку "Изменить роль"
- **Удаление**: нажмите кнопку с иконкой корзины

## Структура админ-панели

### Главная страница (`/admin`)
- Статистика: товары, категории, заказы
- Последние заказы
- Быстрые действия

### Товары (`/admin/products`)
- Список всех товаров
- Добавление нового товара
- Редактирование существующих
- Загрузка изображений через Supabase Storage
- Управление ценами, наличием, характеристиками

### Категории (`/admin/categories`)
- Список категорий на трех языках (RU/KK/EN)
- Добавление/редактирование категорий
- Изменение порядка отображения
- Активация/деактивация

### Контент сайта (`/admin/content`)
- Управление текстами сайта
- Редактирование на трех языках
- Группировка по разделам (hero, services, about, contact)
- Поддержка различных типов контента

### Заказы (`/admin/orders`)
- Список всех заказов
- Изменение статуса заказа
- Просмотр деталей заказа
- Фильтрация по статусам

### Администраторы (`/admin/users`)
- Только для Super Admin
- Управление учетными записями администраторов
- Назначение ролей

## Роли и права доступа

### Super Admin
- Полный доступ ко всем разделам
- Управление другими администраторами
- Управление товарами, категориями, контентом
- Просмотр и изменение заказов

### Admin
- Управление товарами
- Управление категориями
- Управление контентом сайта
- Просмотр и изменение заказов
- НЕ может управлять администраторами

## Безопасность

1. **Row Level Security (RLS)**: Все таблицы защищены политиками RLS
2. **Middleware**: Автоматическая проверка прав доступа
3. **Аутентификация**: Через Supabase Auth
4. **Защита маршрутов**: Неавторизованные пользователи перенаправляются на страницу входа

## Устранение проблем

### Не могу войти
- Проверьте правильность email и пароля
- Убедитесь, что пользователь активен (is_active = true в таблице admins)
- Проверьте наличие записи в таблице admins с вашим user_id

### Ошибка "У вас нет прав доступа"
- Убедитесь, что запись в таблице admins существует
- Проверьте поле user_id в таблице admins
- Убедитесь, что is_active = true

### SQL скрипт не выполняется
- Проверьте подключение к Supabase
- Убедитесь, что у вас есть права на создание таблиц
- Проверьте логи выполнения в v0

### Страница /admin/setup не работает
- Проверьте, что middleware разрешает доступ к /admin/setup
- Попробуйте очистить cookies и кэш браузера
- Используйте вариант Б (через SQL) для создания первого админа

## Контакты поддержки

Если у вас возникли проблемы:
- Email: support@mobilesecurity.kz
- Телефон: +7 778 975 5555
